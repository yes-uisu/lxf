<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- #BeginTemplate "../../../sopc_template.dwt" -->

<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta content="IE=Edge" http-equiv="X-UA-Compatible" />
<!-- #BeginEditable "doctitle" -->
<title>用户定制指令</title>
<!-- #EndEditable -->
<!-- #BeginEditable "description" -->
<meta content="insert DESCRIPTION here" name="description" />
<!-- #EndEditable -->
<meta content="en-us" http-equiv="Content-Language" />
<meta content="General" name="rating" />
<meta content="no" http-equiv="imagetoolbar" />
<meta content="Copyright 2015, Pat Geary  http://genealogy-web-creations.com/ All Rights Reserved" name="copyright" />
<!-- 
*********************************
Design by: Genealogy Web Creations
http://www.genealogy-web-creations.com/
Release Date: May 2015
*********************************
-->
<!-- main css -->
<link href="../../../../styles/site.css" rel="stylesheet" type="text/css" />
<!-- media queries css -->
<link href="../../../../styles/media-queries.css" rel="stylesheet" type="text/css" />
<!-- css3-mediaqueries.js for IE less than 9 --><!--[if lt IE 9]>
<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js">


</script>
<![endif]-->
<meta content="width=device-width; initial-scale=1.0" name="viewport" />
</head>

<body>

<!-- Page Container begins here -->
<div id="outerWrapper">
	<!-- Masthead begins here -->
	<div id="header">
		<img alt="" src="../../../../images/title_pic.png" style="height: 170px; width: 699px" /></div>
	<!-- Masthead ends here -->
	<!-- Top Navigation begins here -->
	<div id="topNavigation">
		<ul>
			<li><a href="../../../../index.html" title="Home">主页</a></li>
			<li><a href="../../../../about.html" title="About">关于</a></li>
			<li><a href="../../../../contact.html" title="Contact">联系</a></li>
			<li><a href="../../../../links.html" title="Links">课程</a></li>
			<li><a href="../../../../search.html" title="Search">搜索</a></li>
			<li><a href="../../../../site-map.html" title="Site Map">站点地图</a></li>
		</ul>
	</div>
	<!-- Top Navigation ends here -->
	<!-- Columns Container begins here -->
	<div id="contentWrapper">
		<!-- Left Sidebar Begins Here	-->
		<div id="leftColumn1">
			<!--	Sectional Menu Begins Here	-->
			<p class="heading">课程</p>
			<ul>
				<li><a href="../../../目录.htm" title="SOPC">SOPC</a></li>
				<li>
				<a href="../../../../embeddedsys/coming.html" title="嵌入式系统应用">嵌入式系统应用</a></li>
				<li><a href="../../../../ecircuit/from-name.htm" title="电子线路设计">电子线路设计</a></li>
			</ul>
			
			<!--	Sectional Menu ends Here	-->
			<p class="heading">教学相长</p>
			<p>认真教书，认真学习</p>
		</div>
		<!-- Left Sidebar ends Here	-->
		<!--Main Content Area Begins Here-->
		<div id="content">
			<div style="color: red; background-color: #000000;"  >
					<div id="content1" onclick="document.all.child1.style.display=(document.all.child1.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第一章 概述</div> 
					<div id="child1" align="left" style="display:none"> 
						1.<a href="../../../SOPC基本概念.htm">SOPC系统的基本概念</a> <br> 
						2.<a href="../../../IP-core.htm">IP核</a> <br> 
						3.<a href="../../../sopc-dev-process.htm">SOPC开发基本流程</a> <br> 
						4.<a href="../../../NiosII-introduction.htm">Nios II处理器介绍</a> <br>
						5.<a href="../../../FPGA-implemented-sopc.htm">用FPGA实现SOPC</a><br>
						6.<a href="../../../nios-app.htm">应用</a><br>
					</div> 
					
					<div id="content2" onclick="document.all.child2.style.display=(document.all.child2.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第二章 Nios II处理器体系结构 </div> 
					<div id="child2" align="left" style="display:none"> 
						1.<a href="../../../NiosII-architecture.htm">Nios II处理器结构</a> <br> 
						2.<a href="../../../Nios-architecture/nios-register.htm">Nios II寄存器的配置</a> <br> 
						3.<a href="../../../Nios-architecture/nios-alu.htm">ALU</a> <br>
						4.<a href="../../../Nios-architecture/operating-modes.htm">Nios II处理器运行模式及</a><br>
						  <a href="../../../Nios-architecture/exception.htm">异常和中断</a> <br>
						5.<a href="../../../Nios-architecture/memory.htm">存储器和外设访问</a><br>
						附录：<a href="../../../Nios-architecture/implement-cpu-instruction.htm">计算机指令执行</a><br>
					</div> 
					<div id="content3" onclick="document.all.child3.style.display=(document.all.child3.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第三章 Avalon接口规范 </div> 
					<div id="child3" style="display:none"> 
						1.<a href="../../../avalon/avalon-introduction.htm">Avalon总线简介</a> <br> 
						2.<a href="../../../avalon/avalon-concept.htm">Avalon总线基本概念</a> <br> 
						3.<a href="../../../avalon/avalon-signal.htm">Avalon信号</a>  <br>
						4.<a href="../../../avalon/avalon-slave.htm">从端口传输</a> <br>
						5.<a href="../../../avalon/avalon-master.htm">主端口传输</a> <br>
						6.<a href="../../../avalon/avalon-streaming.htm">流水线传输</a> <br>
						7.<a href="../../../avalon/avalon-tristate.htm">三态传输</a> <br>
					</div> 
					
					<div id="content4" onclick="document.all.child5.style.display=(document.all.child5.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第四章 SOPC软硬件开发平台 </div> 
					<div id="child5" style="display:none"> 
						1.<a href="../../sopc-dev-platform.htm">SOPC系统开发的软硬件平台</a> <br> 
						2.<a href="#">Quartus II下的SOPC Builder工具</a>(Qsys) <br> 
						3.<a href="#">Nios II IDE集成开发环境</a><br>
						4.<a href="../../software/HAL/Nios_HAL.htm">软硬件接口的硬件抽象层（HAL)</a><br>
						5.<a href="../../example-list.htm">例子</a>
					</div> 
					
					<div id="content5" onclick="document.all.child4.style.display=(document.all.child4.style.display =='none')?'':'none'" > 
					第五章 Nios II处理器常用外设 </div> 
					<div id="child4" style="display:none"> 
						1.<a href="#">并行I/O</a>(重点讲解结构) <br> 
						2.<a href="#">定时器</a> <br> 
						3.<a href="#">异步串口UART</a> <br>
						4.<a href="#">Optrex 1207 LCD</a><br>
						5.<a href="../../devices/SDRAM.htm">SDRAM</a>
					</div> 
					
					<div id="content6" onclick="document.all.child6.style.display=(document.all.child6.style.display =='none')?'':'none'" > 
					第六章 μC/OS II操作系统移植 </div> 
					<div id="child6" style="display:none"> 
						1.<a href="../../software/os/os.htm">操作系统概念</a> <br> 
						2.<a href="../../software/os/ucos/first_ucos.htm">μC/OS II运行在Nios II</a> <br> 
						3.<a href="../../software/os/ucos/ucos_api.htm">μC/OS II编程介绍</a> 
					</div> 
					
					<div id="content8" onclick="document.all.child7.style.display=(document.all.child7.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第七章 Nios II系统深入设计 </div> 
					<div id="child7" style="display:none"> 
						1.<a href="user_instructions.htm">用户定制指令</a> <br> 
						2.<a href="../../develop_user_devices.htm">用户定制外设</a> 
					</div>
					
					<div id="content8" onclick="document.all.child8.style.display=(document.all.child8.style.display =='none')?'':'none'" > 
					<font face="楷体" size="4">第八章 调试技术 </div> 
					<div id="child8" style="display:none"> 
						1.<a href="../../../debug-tech/hardware/ModelSim/modelsim_introduction.htm">ModelSim</a><br>
						2.<a href="../../../debug-tech/hardware/signaltap/signaltap_introduction.htm">SignalTap</a><br>
						3.Nios EDS调试<br> 
					</div> 
			</div>
			<hr/>
			<!-- #BeginEditable "content" -->
			
<p><font size="7">用户定制指令(custom instruction)</font></p>
<p><font size="5">使用Altera Nios II嵌入式处理器，系统设计者可以通过添加定制指令到Nios 
II指令集中，来加速处理对时间要求苛刻的软件算法。</font></p>
<p><font size="5">使用定制指令，用户可以将一个包含多条标准指令的指令序列减少为硬件实现的一条指令。</font></p>
<p><font size="5">应用：</font></p>
<p><font size="5">1、优化数字信号处理的软件的内部循环。</font></p>
<p><font size="5">2、信息包头的处理。</font></p>
<p><font size="5">3、计算密集的应用。</font></p>
<p><font size="5">操作：</font></p>
<p><font size="5">Nios II配置向导提供了图形化的用户界面用来添加多达256条定制指令到Nios II处理器。</font></p>
<p><font size="5">在Qsys中实现用户指令</font></p>
<p><font size="5">■ “Opening the Component Editor” 打开组件编辑器</font></p>
<p><font size="5">■ “Adding the HDL Files” 添加HDL文件</font></p>
<p><font size="5">■ “Configuring the Custom Instruction Signal Type” 配置用户指令信号类型</font></p>
<p><font size="5">■ “Setting Up the Custom Instruction Interfaces” 设置用户指令接口</font></p>
<p><font size="5">■ “Setting the Details” 设置其它细节</font></p>
<p><font size="5">■ “Saving and Adding the Custom Instruction” 保存和添加用户指令 </font>
</p>
<p><font size="5">■ “Generating the System and Compiling in the Quartus II 
Software” 生成系统，在Quartus II软件中编译</font></p>
<p><font size="5">分析代码：（自上而下）</font></p>
<p><font size="5">BSP</font></p>
<p><font size="5">system.h</font></p>
<blockquote>
	<blockquote>
		<p><font size="5">/*<br>
		* Custom instruction macros<br>
		*<br>
		*/<br>
		<br>
		<font color="#FF0000">#define ALT_CI_CRC_0(A) 
		__builtin_custom_ini(ALT_CI_CRC_0_N,(A))<br>
		</font>#define ALT_CI_CRC_0_1(A,B) __builtin_custom_inii(<font color="#0000FF">ALT_CI_CRC_0_1_N</font>,(A),(B))<br>
		#define <font color="#0000FF">ALT_CI_CRC_0_1_N</font> 0x9&nbsp; //1001<br>
		#define ALT_CI_CRC_0_2(A,B) 
		__builtin_custom_inii(ALT_CI_CRC_0_2_N,(A),(B))<br>
		#define ALT_CI_CRC_0_2_N 0xa&nbsp; //1010<br>
		#define ALT_CI_CRC_0_3(A,B) 
		__builtin_custom_inii(ALT_CI_CRC_0_3_N,(A),(B))<br>
		#define ALT_CI_CRC_0_3_N 0xb&nbsp; //1011<br>
		#define ALT_CI_CRC_0_4(n,A,B) 
		__builtin_custom_inii(ALT_CI_CRC_0_4_N+(n&amp;ALT_CI_CRC_0_4_N_MASK),(A),(B))<br>
		#define ALT_CI_CRC_0_4_N 0x0<br>
		#define ALT_CI_CRC_0_4_N_MASK ((1&lt;&lt;3)-1) //0111<br>
		#define <font color="#FF0000">ALT_CI_CRC_0_N</font> 0x8&nbsp;&nbsp; 
		//1000</font></p>
	</blockquote>
</blockquote>
	<p><font size="5">硬件实现</font></p>
<p><font size="5">CRC_Custom_Instruction.v</font></p>
<p><font size="5">输入管脚n是指令选择。</font></p>
<p>assign address = (n==0)?3'b000 : ((n==1)|(n==2)|(n==3))?3'b001 : 
(n==4)?3'b100 : (n==5)?3'b101 : (n==6)?3'b110 : 3'b111;</p>
<p><font size="5">CRC_Component.v</font></p>
			


<p><font size="5">assign mux_result = (address == 3'b100)? result_xored[31:0] :<br>
((address == 3'b101)? result_xored[63:32] :<br>
((address == 3'b110)? result_xored[95:64] : result_xored[crc_width-1:96]));</font></p>
<p><font size="5">软件实现和硬件实现的比较</font></p>
<blockquote>
	<p><font size="5">
	<span style="font-family; color: rgb(0,0,0); font-style: normal; font-variant: normal">
	******************************************************************************<br>
	Comparison between software and custom instruction CRC32<br>
	******************************************************************************<br>
	System specification<br>
	--------------------<br>
	System clock speed = 62.5 MHz<br>
	Number of buffer locations = 16<br>
	Size of each buffer = 65535 bytes<br>
	Initializing all of the buffers with pseudo-random data<br>
	-------------------------------------------------------<br>
	Initialization completed<br>
	Running the software CRC<br>
	------------------------<br>
	Completed<br>
	Running the optimized software CRC<br>
	----------------------------------<br>
	Completed<br>
	Running the custom instruction CRC<br>
	----------------------------------<br>
	Completed<br>
	Validating the CRC results from all implementations<br>
	---------------------------------------------------<br>
	All CRC implementations produced the same results<br>
	Processing time for each implementation<br>
	---------------------------------------<br>
	Software CRC = 9938.35 ms<br>
	Optimized software CRC = 6472.89 ms<br>
	Custom instruction CRC = 132.29 ms<br>
	Processing throughput for each implementation<br>
	---------------------------------------------<br>
	Software CRC = 0.84 Mbps<br>
	Optimized software CRC = 1.30 Mbps<br>
	Custom instruction CRC = 63.41 Mbps<br>
	Speedup ratio<br>
	-------------<br>
	Custom instruction CRC vs software CRC = 75.1<br>
	Custom instruction CRC vs optimized software CRC = 48.9<br>
	Optimized software CRC vs software CRC = 1.5</span></font><span style="font-family: ;font-size:9pt;color:rgb(0,0,0);font-style:normal;font-variant:normal;"><br style=" font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; ">
	<br class="Apple-interchange-newline">
	　</span></p>
</blockquote>
			
			aa
			
			<!-- #EndEditable --></div>
		<!--Main Content Area Ends Here--></div>
	<!-- Columns Container ends here -->
	<!-- Footer begins here -->
	<div id="footer">
		
		<p class="smltxt">模板来自于:
		<a href="http://www.genealogy-web-creations.com/" title="Genealogy Web Creations.">
		Genealogy Web Creations</a> </p>
		<p class="smltxt">Template Updated: May 2015 </p>
		<p class="smltxt"><a href="http://www.miitbeian.gov.cn/" title="备案后">京ICP备15041520号</a></p>
	</div>
	<!-- Footer ends here -->
	<!-- Page Container ends here --></div>

</body>

<!-- #EndTemplate -->

</html>
